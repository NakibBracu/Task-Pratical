@model MeetingMaster
@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<form role="form" asp-antiforgery="true" asp-action="SaveMeetingDetails"
      asp-area="" asp-controller="Customer" method="post">

    <div class="card-body">
        <div asp-validation-summary="All" class="text-danger"></div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="customerType" id="corporateRadio" value="Corporate">
        <label class="form-check-label" for="corporateRadio">
            Corporate
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="customerType" id="individualRadio" value="Individual">
        <label class="form-check-label" for="individualRadio">
            Individual
        </label>
    </div>

    <!-- Dropdown for CustomerName -->
    <!-- Container to hold both dropdown and MeetingAgenda input -->
    <div class="form-group mt-3">
        <div class="row" style="margin-bottom:10px">
            <!-- Dropdown for CustomerName -->
                <div class="col-md-6 d-flex align-items-center">
                    <label for="customerDropdown">Customer Name:</label>
                    <select class="form-control" id="customerDropdown" name="customerName">
                        <!-- Options will be populated dynamically using JavaScript -->
                    </select>
                    <input type="hidden" id="customerId" name="customerId">
                </div>

            <!-- Input for MeetingAgenda -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="MeetingAgenda" class="required" style="margin-right: 8px;">Meeting Agenda:</label>
                <div style="flex: 1;">
                    <textarea asp-for="MeetingAgenda" class="form-control overflow-auto" style="height: auto; min-height: 38px;" aria-required="true" placeholder="Meeting Agenda" required></textarea>
                </div>
                <span asp-validation-for="MeetingAgenda" class="text-danger"></span>
            </div>

        </div>

        <!--Date and Time-->
        <div class="row" style="margin-bottom:10px">
            <!-- Input for meetingDate -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="Date" class="required">Meeting Date:</label>
                <input asp-for="Date" class="form-control" type="date" required />
            </div>

            <!-- Input for meetingTime -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="Time" class="required">Meeting Time:</label>
                <input asp-for="Time" class="form-control" type="time" step="1800" required />
            </div>

        </div>

        <!--Meeting Place and Decision-->
        <div class="row" style="margin-bottom:10px">
            <!-- Input for MeetingPlace -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="MeetingPlace" class="required" style="margin-right: 8px;">Meeting Place:</label>
                <div style="flex: 1;">
                    <textarea asp-for="MeetingPlace" class="form-control overflow-auto" style="height: auto; min-height: 38px;" aria-required="true" placeholder="Meeting Place" required></textarea>
                </div>
                <span asp-validation-for="MeetingPlace" class="text-danger"></span>
            </div>

            <!-- Input for MeetingDiscussion -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="MeetingDiscussion" class="required" style="margin-right: 8px;">Meeting Discussion:</label>
                <div style="flex: 1;">
                    <textarea asp-for="MeetingDiscussion" class="form-control overflow-auto" style="height: auto; min-height: 38px;" aria-required="true" placeholder="Meeting Discussion" required></textarea>
                </div>
                <span asp-validation-for="MeetingDiscussion" class="text-danger"></span>
            </div>

        </div>

        <!--Meeting Attendence Client Side and Decision-->
        <div class="row" style="margin-bottom:10px">
            <!-- Input for MeetingPlace -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="AttendsFromClientSide" class="required" style="margin-right: 8px;">Attends From Client Side:</label>
                <div style="flex: 1;">
                    <textarea asp-for="AttendsFromClientSide" class="form-control overflow-auto" style="height: auto; min-height: 38px;" aria-required="true" placeholder="Present Client Side" required></textarea>
                </div>
                <span asp-validation-for="AttendsFromClientSide" class="text-danger"></span>
            </div>

            <!-- Input for MeetingDecision -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="MeetingDecision" class="required" style="margin-right: 8px;">Meeting Decision:</label>
                <div style="flex: 1;">
                    <textarea asp-for="MeetingDecision" class="form-control overflow-auto" style="height: auto; min-height: 38px;" aria-required="true" placeholder="Meeting decision" required></textarea>
                </div>
                <span asp-validation-for="MeetingDecision" class="text-danger"></span>
            </div>

        </div>

        <div class="row" style="margin-bottom:10px">
            <!-- Input for AttendsFromHosTside -->
            <div class="col-md-6 d-flex align-items-center">
                <label asp-for="AttendsFromHostSide" class="required" style="margin-right: 8px;">Attends From Host Side:</label>
                <div style="flex: 1;">
                    <textarea asp-for="AttendsFromHostSide" class="form-control overflow-auto" style="height: auto; min-height: 38px;" aria-required="true" placeholder="Present self side" required></textarea>
                </div>
                <span asp-validation-for="AttendsFromHostSide" class="text-danger"></span>
            </div>

        </div>

    </div>

    </div>
    <div class="card-footer">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>

       
   
</form>

@section Scripts {
    <script>
        function loadCustomerNames() {
            var customerType = document.querySelector('input[name="customerType"]:checked').value;
            var customerDropdown = document.getElementById("customerDropdown");
            customerDropdown.innerHTML = ""; // Clear existing options

            // Make an AJAX request to fetch customer names based on the selected radio button
            fetch(`/Customer/GetCustomerNames?customerType=${customerType}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(customer => {
                        var option = document.createElement("option");
                        option.text = customer[1]; // Accessing the name from the tuple
                        option.value = customer[0]; // Accessing the ID from the tuple
                        customerDropdown.add(option);
                    });
                })
                .catch(error => console.error('Error fetching customer names:', error));
        }

        // Event listener to trigger loadCustomerNames function when radio buttons are changed
        document.querySelectorAll('input[name="customerType"]').forEach(radio => {
            radio.addEventListener("change", loadCustomerNames);
        });

        // Event listener to set customerId when a customer is selected
        document.getElementById("customerDropdown").addEventListener("change", function () {
            var selectedCustomerId = this.value;
            // console.log('Selected Customer ID:', selectedCustomerId); // Debugging: Log the selected customer ID
            document.getElementById("customerId").value = selectedCustomerId;
        });

        // Initially load customer names based on the default selected radio button
        loadCustomerNames();

    </script>
}
